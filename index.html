<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ฟอร์มแจ้งซ่อมสำหรับลูกค้า</title>
    <style>
        /* เดิมทั้งหมดเหมือนของคุณ */
        /* … (คงสไตล์เดิมไว้) … */
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ฟอร์มแจ้งซ่อม</h1>
            <p>บริษัท ไท พลัส ก่อสร้าง จำกัด | THAI PLUS CONSTRUCTION CO.,LTD.</p>
        </div>
        
        <div class="form-container">
            <!-- … ส่วนอื่นเหมือนเดิม … -->

            <div id="repairItems"></div>
            <button type="button" class="add-issue-btn" onclick="addRepairItem()">เพิ่มรายการซ่อม</button>
            <button type="submit" class="submit-btn">ส่งคำร้องซ่อม</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        let repairCount = 0;
        document.addEventListener('DOMContentLoaded', function() {
            addRepairItem();
            document.querySelector('input[name="reportDate"]').valueAsDate = new Date();
        });

        function addRepairItem() {
            repairCount++;
            const repairItemsContainer = document.getElementById('repairItems');
            const repairItem = document.createElement('div');
            repairItem.className = 'issue-item';
            repairItem.innerHTML = `
                <div class="issue-header">
                    <div class="issue-number">รายการที่ ${repairCount}</div>
                    ${repairCount > 1 ? '<button type="button" class="remove-issue" onclick="removeRepairItem(this)">ลบรายการ</button>' : ''}
                </div>
                <div class="form-group">
                    <label>ตำแหน่งที่เกิดปัญหา <span class="required">*</span></label>
                    <input type="text" name="location_${repairCount}" required placeholder="เช่น ห้องนั่งเล่น ชั้น 2">
                </div>
                <div class="form-group">
                    <label>ประเภทงานซ่อม <span class="required">*</span></label>
                    <select name="repairCategory_${repairCount}" class="repair-category-select" required>
                        <option value="">-- โปรดเลือกประเภทงาน --</option>
                        <option value="Structural Work">งานโครงสร้าง</option>
                        <option value="Electrical / Lighting">งานไฟฟ้า/ระบบแสงสว่าง</option>
                        <option value="Plumbing / Sanitary">งานระบบประปา/สุขาภิบาล</option>
                        <option value="HVAC">งานระบบปรับอากาศ/ระบายอากาศ</option>
                        <option value="Architectural Finishes">งานตกแต่ง/ฝ้า/ผนัง/สี</option>
                        <option value="Doors / Windows / Hardware">งานประตู-หน้าต่าง/อุปกรณ์ฮาร์ดแวร์</option>
                        <option value="CCTV / Network">งานระบบ IT / กล้องวงจรปิด / ระบบเสียง</option>
                        <option value="Flooring">งานพื้น</option>
                        <option value="Other">งานอื่น ๆ</option>
                    </select>
                </div>
                <div id="otherCategoryInput_${repairCount}" class="form-group other-input" style="display:none">
                    <label>ระบุประเภทงานอื่น ๆ:</label>
                    <input type="text" name="otherCategory_${repairCount}">
                </div>
                <div class="form-group">
                    <label>รายละเอียดปัญหา <span class="required">*</span></label>
                    <textarea name="issue_${repairCount}" required></textarea>
                </div>
                <div class="form-group">
                    <label>เมื่อไหร่ที่พบปัญหานี้</label>
                    <input type="text" name="whenFound_${repairCount}">
                </div>
                <div class="form-group">
                    <label>แนบรูปภาพประกอบ <span class="required">*</span></label>
                    <div class="image-upload">
                        <label for="images_${repairCount}" class="image-upload-label">+ เลือกรูปภาพ</label>
                        <input type="file" id="images_${repairCount}" name="images_${repairCount}" multiple accept="image/*" required style="display:none" onchange="previewImages(this, 'preview-container-${repairCount}')">
                        <div id="preview-container-${repairCount}" class="image-preview-container"></div>
                    </div>
                </div>`;
            repairItemsContainer.appendChild(repairItem);

            document.querySelector(`select[name="repairCategory_${repairCount}"]`).addEventListener('change', function() {
                document.getElementById(`otherCategoryInput_${repairCount}`).style.display = this.value === 'Other' ? 'block' : 'none';
            });
        }

        function removeRepairItem(btn){
            btn.closest('.issue-item').remove();
            const items = document.querySelectorAll('.issue-item');
            items.forEach((el,idx)=>el.querySelector('.issue-number').textContent=`รายการที่ ${idx+1}`);
            repairCount = items.length;
        }

        function previewImages(input, id){
            const c = document.getElementById(id);
            c.innerHTML='';
            [...input.files].forEach((f,i)=>{
                const r=new FileReader();
                r.onload=e=>{
                    const d=document.createElement('div');
                    d.className='image-preview';
                    d.innerHTML=`<img src="${e.target.result}"><button type="button" class="remove-image" onclick="removeImage(this,'${input.id}',${i})">×</button>`;
                    c.appendChild(d);
                };
                r.readAsDataURL(f);
            });
        }
        function removeImage(btn,id,idx){
            const input=document.getElementById(id);
            const files=[...input.files];
            files.splice(idx,1);
            const dt=new DataTransfer();
            files.forEach(f=>dt.items.add(f));
            input.files=dt.files;
            previewImages(input,btn.closest('.image-preview-container').id);
        }
    </script>
</body>
</html>
